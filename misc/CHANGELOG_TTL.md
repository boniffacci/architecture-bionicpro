# Изменения в управлении TTL отчётов

## Дата: 2025-12-02

### Проблема
Ранее TTL для отчётов настраивался на двух уровнях:
1. В `reports_api` через метаданные/tags при сохранении файла (7 дней)
2. В `minio` через lifecycle policy (40 дней)

Это создавало избыточность и усложняло код.

### Решение
Централизовано управление TTL на уровне MinIO с периодом **7 дней**.

### Изменённые файлы

#### 1. `minio/init-minio.sh`
- Изменён TTL с 40 дней на **7 дней**
- Lifecycle policy применяется ко всем файлам в бакете `reports`
- Правило `ExpireOldReports` автоматически удаляет файлы старше 7 дней

#### 2. `reports_api/main.py`
- **Удалены импорты**: `LifecycleConfig`, `Rule`, `Expiration`, `timedelta`
- **Упрощена функция `init_minio()`**:
  - Убрана установка lifecycle policy (теперь настраивается в MinIO)
  - Добавлено информационное сообщение о TTL
- **Упрощена функция `generate_report_data()`**:
  - Убрана установка tags с TTL при сохранении файла
  - Простое сохранение без дополнительных метаданных
  - Упрощённое логирование

#### 3. `task_3_s3_storage/README.md`
- Обновлена секция "TTL для файлов отчётов"
- Описана новая централизованная схема управления TTL
- Убрано упоминание о двухуровневой системе TTL

### Преимущества

1. **Централизация**: TTL управляется в одном месте (MinIO)
2. **Упрощение кода**: Меньше логики в приложении
3. **Единообразие**: Один TTL для всех отчётов (7 дней)
4. **Надёжность**: MinIO гарантирует удаление файлов

### Проверка

```bash
# Проверить lifecycle policy
docker exec minio mc ilm export local/reports

# Ожидаемый результат:
# {"Rules":[{"Expiration":{"Days":7},"ID":"ExpireOldReports","Status":"Enabled"}]}

# Создать тестовые отчёты
./test_reports_minio.sh

# Проверить логи reports-api
docker compose logs reports-api | grep "Отчёт сохранён"

# Ожидаемый результат:
# INFO:root:Отчёт сохранён в MinIO: default/{user_uuid}/{filename}
# (без упоминания TTL или даты истечения)
```

### Результат

✅ TTL настроен централизованно в MinIO (7 дней)  
✅ Код упрощён и очищен от избыточной логики  
✅ Документация обновлена  
✅ Все тесты проходят успешно
