# BionicPRO: ETL –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç—á—ë—Ç–æ–≤
# –†–µ—à–µ–Ω–∏–µ –¥–ª—è 9-–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞ –∫—É—Ä—Å–∞ "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü–û"

## üìã –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä

–≠—Ç–æ –ø–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç—á—ë—Ç–æ–≤ BionicPRO –≤–∫–ª—é—á–∞–µ—Ç:

1. **–°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö** (`database_schemas.py`)
   - CRM –ë–î (PostgreSQL): users, prosthetics, subscriptions, payments, support_tickets
   - Telemetry –ë–î (PostgreSQL): events, battery_metrics
   - Reports –ë–î (ClickHouse): –≤–∏—Ç—Ä–∏–Ω—ã –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤

2. **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (`generate_test_data.py`)
   - 12 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - ~15 –ø—Ä–æ—Ç–µ–∑–æ–≤
   - 2.5 –≥–æ–¥–∞ –∏—Å—Ç–æ—Ä–∏–∏
   - ~450,000 —Å–æ–±—ã—Ç–∏–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏

3. **ETL-–ø—Ä–æ—Ü–µ—Å—Å** (`airflow_etl_dag.py`)
   - DAG: `bionicpro_etl_daily`
   - –ó–∞–ø—É—Å–∫: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00 UTC
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ‚Üí –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ –≤ ClickHouse

4. **–í–∏—Ç—Ä–∏–Ω—ã –æ—Ç—á—ë—Ç–æ–≤** (ClickHouse)
   - `report_user_monthly_metrics` ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ KPI
   - `report_prosthetic_monthly_metrics` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ KPI

5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`ARCHITECTURE_RU.md`)
   - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - SQL-–∑–∞–ø—Ä–æ—Å—ã
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install sqlalchemy psycopg2-binary apache-airflow clickhouse-driver

# –°–æ–∑–¥–∞–Ω–∏–µ –ë–î PostgreSQL
createdb crm_db
createdb telemetry_db

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Airflow
airflow db init
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

```bash
python database_schemas.py
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL.

### –®–∞–≥ 3: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
python generate_test_data.py
```

**–í—ã–≤–æ–¥:**
```
======================================================================
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö BionicPRO
======================================================================
–ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π CRM...
‚úì –°–æ–∑–¥–∞–Ω–æ 12 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø—Ä–æ—Ç–µ–∑—ã CRM...
‚úì –°–æ–∑–¥–∞–Ω–æ 15 –ø—Ä–æ—Ç–µ–∑–æ–≤
–ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ–¥–ø–∏—Å–∫–∏ CRM...
‚úì –°–æ–∑–¥–∞–Ω–æ 9 –ø–æ–¥–ø–∏—Å–æ–∫
–ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–ª–∞—Ç–µ–∂–∏ CRM...
‚úì –°–æ–∑–¥–∞–Ω–æ 234 –ø–ª–∞—Ç–µ–∂–µ–π
–ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É CRM...
‚úì –°–æ–∑–¥–∞–Ω–æ 47 –æ–±—Ä–∞—â–µ–Ω–∏–π –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
–ì–µ–Ω–µ—Ä–∏—Ä—É—é —Å–æ–±—ã—Ç–∏—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏...
‚úì –°–æ–∑–¥–∞–Ω–æ 456000 —Å–æ–±—ã—Ç–∏–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
–ì–µ–Ω–µ—Ä–∏—Ä—É—é –º–µ—Ç—Ä–∏–∫–∏ –±–∞—Ç–∞—Ä–µ–∏...
‚úì –°–æ–∑–¥–∞–Ω–æ 45000 –º–µ—Ç—Ä–∏–∫ –±–∞—Ç–∞—Ä–µ–∏
======================================================================
‚úì –í–°–ï –î–ê–ù–ù–´–ï –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–´ –£–°–ü–ï–®–ù–û!
======================================================================
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ClickHouse

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞ ARCHITECTURE_RU.md
# –†–∞–∑–¥–µ–ª 6.3 "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ ClickHouse"

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DDL —Å–∫—Ä–∏–ø—Ç—ã (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
```

### –®–∞–≥ 5: –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Airflow

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
airflow variables set CRM_DATABASE_URL "postgresql://user:pass@localhost/crm_db"
airflow variables set TELEMETRY_DATABASE_URL "postgresql://user:pass@localhost/telemetry_db"
airflow variables set CLICKHOUSE_DATABASE_URL "clickhouse://default:@localhost/reports_db"

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å DAG
cp airflow_etl_dag.py $AIRFLOW_HOME/dags/

# –ó–∞–ø—É—Å—Ç–∏—Ç—å scheduler
airflow scheduler

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: –∑–∞–ø—É—Å—Ç–∏—Ç—å webserver
airflow webserver --port 8080
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080

DAG `bionicpro_etl_daily` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

---

## üìä –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –í–∏—Ç—Ä–∏–Ω–∞ 1: report_user_monthly_metrics

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ –º–µ—Å—è—Ü–∞–º

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|---------|--------|
| `total_payments` | –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –∑–∞ –º–µ—Å—è—Ü | 8997.00 —Ä—É–± |
| `successful_payments` | –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–µ–¥—à–∏–µ | 5998.00 —Ä—É–± |
| `failed_payments_count` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ | 1 |
| `active_subscriptions_count` | –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ | 1 |
| `subscription_cost_total` | –°—É–º–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ | 2999.00 —Ä—É–± |

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤**:
```sql
-- –û—Ç—á—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –º–µ—Å—è—Ü
SELECT * FROM report_user_monthly_metrics 
WHERE user_id = 1 AND report_date = '2024-01-01';

-- –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º
SELECT * FROM report_user_monthly_metrics 
WHERE report_date = '2024-01-01'
ORDER BY successful_payments DESC LIMIT 10;
```

### –í–∏—Ç—Ä–∏–Ω–∞ 2: report_prosthetic_monthly_metrics

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ—Ç–µ–∑–æ–≤

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|---------|--------|
| `power_on_count` | –í–∫–ª—é—á–µ–Ω–∏–π –≤ –¥–µ–Ω—å | 28 |
| `total_active_hours` | –ß–∞—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | 12.5 —á |
| `avg_discharge_rate_active` | –†–∞–∑—Ä—è–¥–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ | 85.5 mAh/h |
| `avg_charge_rate` | –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞—Ä—è–¥–∫–∏ | 200.0 mAh/h |
| `charge_cycles` | –¶–∏–∫–ª–æ–≤ –∑–∞—Ä—è–¥–∫–∏ | 2 |
| `error_count` | –û—à–∏–±–∫–∏ (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ) | 0 |
| `critical_error_count` | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏ | 0 |
| `downtime_minutes` | –ú–∏–Ω—É—Ç—ã –ø—Ä–æ—Å—Ç–æ—è | 0 |

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤**:
```sql
-- –û—Ç—á—ë—Ç –ø—Ä–æ—Ç–µ–∑–∞ –∑–∞ –º–µ—Å—è—Ü
SELECT * FROM report_prosthetic_monthly_metrics
WHERE user_id = 1 AND prosthetic_id = 1 
  AND report_date = '2024-01-01';

-- –ê–Ω–∞–ª–∏–∑ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤
SELECT report_date, error_count, critical_error_count,
       100 - (error_count + critical_error_count) / power_on_count * 100 AS reliability_pct
FROM report_prosthetic_monthly_metrics
WHERE prosthetic_id = 1 AND report_date >= '2023-07-01'
ORDER BY report_date DESC;
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
PostgreSQL CRM          PostgreSQL Telemetry
‚îú‚îÄ‚îÄ crm_users           ‚îú‚îÄ‚îÄ telemetry_events
‚îú‚îÄ‚îÄ crm_prosthetics     ‚îî‚îÄ‚îÄ battery_metrics
‚îú‚îÄ‚îÄ crm_subscriptions
‚îú‚îÄ‚îÄ crm_payments
‚îî‚îÄ‚îÄ crm_support_tickets
         ‚Üì                          ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Apache Airflow DAG            ‚îÇ
    ‚îÇ  bionicpro_etl_daily           ‚îÇ
    ‚îÇ  (02:00 UTC –µ–∂–µ–¥–Ω–µ–≤–Ω–æ)         ‚îÇ
    ‚îÇ                                ‚îÇ
    ‚îÇ  Extract ‚Üí Transform ‚Üí Load    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚Üì
         ClickHouse
         reports_db
    ‚îú‚îÄ‚îÄ report_user_monthly_metrics
    ‚îî‚îÄ‚îÄ report_prosthetic_monthly_metrics
                 ‚Üì
          API –û—Ç—á—ë—Ç–æ–≤
         /reports/{id}
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
.
‚îú‚îÄ‚îÄ database_schemas.py              # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (SQLAlchemy)
‚îú‚îÄ‚îÄ generate_test_data.py            # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ airflow_etl_dag.py               # DAG –¥–ª—è Airflow
‚îú‚îÄ‚îÄ clickhouse_queries.sql           # –ü—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ ARCHITECTURE_RU.md               # –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îî‚îÄ‚îÄ README.md                        # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ OLTP –∏ OLAP

- **OLTP** (PostgreSQL): CRM, Telemetry ‚Äî –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **OLAP** (ClickHouse): Reports ‚Äî –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω

### 2. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º

```sql
PARTITION BY toYYYYMM(report_date)
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### 3. ORDER BY –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```sql
ORDER BY (user_id, prosthetic_id, report_date)
```

- –ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: O(log N) –≤–º–µ—Å—Ç–æ O(N)
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ `WHERE user_id = ?`

### 4. ETL –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤ 02:00 UTC
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å
- XCom –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

```bash
psql -d crm_db -c "SELECT COUNT(*) FROM crm_users;"
# Output: 12

psql -d telemetry_db -c "SELECT COUNT(*) FROM telemetry_events;"
# Output: 456000
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ ClickHouse

```bash
clickhouse-client -d reports_db -q "
SELECT COUNT(*) FROM report_user_monthly_metrics;
"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Airflow

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DAG
airflow dags list | grep bionicpro

# –í—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å—Ç–∏—Ç—å DAG
airflow dags trigger -e 2024-01-02 bionicpro_etl_daily

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
airflow tasks logs bionicpro_etl_daily extract_crm_data 2024-01-02
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Airflow

```bash
export AIRFLOW__DATABASE__SQL_ALCHEMY_CONN="postgresql+psycopg2://user:pass@localhost/airflow"
export AIRFLOW__CORE__DAGS_FOLDER="/path/to/dags"
export AIRFLOW__CORE__PLUGINS_FOLDER="/path/to/plugins"
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Airflow UI

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ Airflow ‚Üí Admin ‚Üí Variables:

```json
{
  "CRM_DATABASE_URL": "postgresql://user:pass@localhost/crm_db",
  "TELEMETRY_DATABASE_URL": "postgresql://user:pass@localhost/telemetry_db",
  "CLICKHOUSE_DATABASE_URL": "clickhouse://default:@localhost/reports_db"
}
```

---

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ–∫—É—â–∏–µ —Ä–∞–∑–º–µ—Ä—ã

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 12
- –ü—Ä–æ—Ç–µ–∑–æ–≤: ~15
- –°–æ–±—ã—Ç–∏—è: ~450,000
- –†–∞–∑–º–µ—Ä –ë–î: ~100 MB

### –ü—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–æ 10,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **Incremental ETL** –≤–º–µ—Å—Ç–æ full refresh
2. **Change Data Capture (CDC)** —Å Debezium + Kafka
3. **–†–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** –≤ ClickHouse
4. **–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö –ø–æ user_id
5. **–ë–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏** (–ø–æ –¥–Ω—è–º, –∞ –Ω–µ –º–µ—Å—è—Ü–∞–º)

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: DAG –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
python -m py_compile airflow_etl_dag.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
airflow dags test bionicpro_etl_daily 2024-01-02
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ª–∏ DAG
airflow dags list --dag-id bionicpro_etl_daily

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á
airflow tasks list bionicpro_etl_daily

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ load_to_clickhouse
airflow tasks logs bionicpro_etl_daily load_to_clickhouse 2024-01-02
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å PostgreSQL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
psql postgresql://user:pass@localhost/crm_db -c "SELECT 1;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Python
python -c "from database_schemas import *; print('OK')"
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **ClickHouse –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://clickhouse.com/docs/
- **Apache Airflow –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://airflow.apache.org/docs/
- **SQLAlchemy –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://docs.sqlalchemy.org/
- **PostgreSQL –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://www.postgresql.org/docs/

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∫—É—Ä—Å–∞ "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü–û". –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–†–µ—à–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–∞–∫ —á–∞—Å—Ç—å 9-–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞ –∫—É—Ä—Å–∞ "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü–û" –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ü—Ä–∞–∫—Ç–∏–∫—É–º.

---

## ‚ùì FAQ

**Q: –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ ClickHouse, –∞ –Ω–µ Elasticsearch/Redshift/BigQuery?**
A: ClickHouse –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –û—Ç–∫—Ä—ã—Ç—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (–º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ)
- –≠–∫–æ–Ω–æ–º–∏—á–µ–Ω –≤ —Ä–µ—Å—É—Ä—Å–∞—Ö
- –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä—Ç–∏—Ü–∏–π –∏ ORDER BY
- –ü—Ä–æ—Å—Ç–æ–π SQL (–ø–æ—Ö–æ–∂ –Ω–∞ PostgreSQL)
- –ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

**Q: –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ë–î (crm_db –∏ telemetry_db)?**
A: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é –ë–î
- –†–∞–∑–Ω—ã–µ SLA –∏ backup strategies
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (CRM) –æ—Ç –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (telemetry)
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ETL?**
A: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00 UTC (–Ω–æ—á—å—é, –∫–æ–≥–¥–∞ –º–µ–Ω—å—à–µ –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏). –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—á–µ—Ä–∞—à–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

**Q: –ú–æ–≥—É –ª–∏ —è –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–∏—Ç—Ä–∏–Ω—É?**
A: –î–∞! –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ –∫–ª–∞—Å—Å –≤ `database_schemas.py`, –∑–∞–¥–∞—á—É Transform –≤ `airflow_etl_dag.py` –∏ –∑–∞–¥–∞—á—É Load.

---

**Happy reporting! üìä**
