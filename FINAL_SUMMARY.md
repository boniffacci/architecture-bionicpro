# âœ… Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€ĞµĞ·ÑĞ¼Ğµ: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Apache Airflow 3.1.3

## Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ

Ğ’ÑĞµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹. Apache Airflow 3.1.3 Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒÑ.

---

## ğŸ¯ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸

### 1. âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ClickHouse

**Ğ¤Ğ°Ğ¹Ğ»:** `/dags/import_olap_data.py`

- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `users`: Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ½Ğ° `ReplacingMergeTree() ORDER BY user_uuid`
- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `telemetry_events`: Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ½Ğ° `ReplacingMergeTree(saved_ts)` Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
- Ğ¡Ñ…ĞµĞ¼Ñ‹ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ `debezium.*` ÑÑ…ĞµĞ¼Ğ°Ğ¼ Ğ¸Ğ· `reports_api`

### 2. âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° start_date Ğ½Ğ° 1 ÑĞ½Ğ²Ğ°Ñ€Ñ 2025

**Ğ¤Ğ°Ğ¹Ğ»:** `/dags/import_olap_data.py`

```python
dag = DAG(
    'import_olap_data_monthly',
    schedule='0 1 1 * *',
    start_date=datetime(2025, 1, 1, tzinfo=timezone.utc),
    catchup=True,
    ...
)
```

### 3. âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Apache Airflow 3.1.3

**Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ² `docker-compose.yaml`:**

1. **airflow-db** (PostgreSQL 17)
   - ĞŸĞ¾Ñ€Ñ‚: 5446
   - Ğ‘Ğ”: `airflow_db`
   - ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: `airflow_user` / `airflow_password`

2. **airflow-webserver** â†’ **airflow-api-server**
   - ĞŸĞ¾Ñ€Ñ‚: 8082
   - ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°: `api-server` (Ğ²Ğ¼ĞµÑÑ‚Ğ¾ `webserver` Ğ² Airflow 3.x)
   - URL: http://localhost:8082

3. **airflow-dag-processor** â­ (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ² Airflow 3.x)
   - ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°: `dag-processor`
   - ĞÑ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ DAG'Ğ¾Ğ²
   - ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ğ°Ğ¶ĞµĞ½ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Airflow 3.x

4. **airflow-scheduler**
   - ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°: `scheduler`
   - Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ `airflow-dag-processor`

5. **airflow-init**
   - Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”
   - Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ `airflow_admin` / `airflow_password`

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:**
- `/airflow/Dockerfile` - Ğ¾Ğ±Ñ€Ğ°Ğ· Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸
- `/airflow/init_airflow.sh` - ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### 4. âœ… ĞĞ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Airflow 3.x

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `import_olap_data.py`:**

```python
# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ²
from airflow.providers.standard.operators.python import PythonOperator

# schedule Ğ²Ğ¼ĞµÑÑ‚Ğ¾ schedule_interval
schedule='0 1 1 * *'

# Ğ‘ĞµĞ· provide_context (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ² 3.x)
import_task = PythonOperator(
    task_id='import_previous_month_data',
    python_callable=import_previous_month,
    dag=dag
)
```

### 5. âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚

**Ğ¤Ğ°Ğ¹Ğ»:** `/tests/test_airflow_integration.py`

Ğ¢ĞµÑÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚:
- `docker compose down -v` / `build` / `up -d`
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²ÑĞµÑ… ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ² (Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ `airflow-dag-processor`)
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ DAG Ñ‡ĞµÑ€ĞµĞ· CLI
- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (`/populate_base`)
- ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¸ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ DAG
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² ClickHouse

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Airflow CLI** (Ğ²Ğ¼ĞµÑÑ‚Ğ¾ REST API):
```bash
airflow dags list
airflow dags unpause import_olap_data_monthly
airflow dags trigger import_olap_data_monthly
```

### 6. âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°

**Ğ¤Ğ°Ğ¹Ğ»:** `/bionicpro_frontend/src/App.tsx`

**Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ±Ğ»Ğ¾Ğº "ETL-Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸":**

1. **ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ·ĞµÑ€Ğ¾Ğ² Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ"**
   - Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ `/populate_base` Ñƒ `crm_api` Ğ¸ `telemetry_api`
   - ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹

2. **ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ETL-Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ"**
   - ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ DAG Ñ‡ĞµÑ€ĞµĞ· CLI
   - Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¸Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ
   - ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Airflow UI Ğ² Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞµ

**Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ ĞºÑÑˆĞ° Ğ² Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°Ñ…:**
- ğŸ“¦ "Ğ˜Ğ· ĞºÑÑˆĞ°" (ĞµÑĞ»Ğ¸ `from_cache === true`)
- ğŸ”„ "ĞĞµ Ğ¸Ğ· ĞºÑÑˆĞ°" (ĞµÑĞ»Ğ¸ `from_cache === false`)

### 7. âœ… Playwright-Ñ‚ĞµÑÑ‚ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°

**Ğ¤Ğ°Ğ¹Ğ»:** `/tests/test_frontend_etl.py`

ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚:
- ĞĞ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ° ETL-Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- Ğ Ğ°Ğ±Ğ¾Ñ‚Ñƒ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- Ğ Ğ°Ğ±Ğ¾Ñ‚Ñƒ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° ETL
- ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ° ĞºÑÑˆĞ°
- ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Airflow UI Ğ² Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞµ

### 8. âœ… Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ñ„Ğ°Ğ¹Ğ»Ñ‹:
- `AIRFLOW_ETL_README.md` - Ğ¾Ğ±Ñ‰ĞµĞµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾
- `AIRFLOW_3_MIGRATION.md` - Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ 3.x
- `AIRFLOW_3_FINAL_SETUP.md` - Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°
- `IMPLEMENTATION_SUMMARY_AIRFLOW.md` - Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€ĞµĞ·ÑĞ¼Ğµ

---

## ğŸš€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ¾ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸

### Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°

```bash
# 1. Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
docker compose up -d

# 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Airflow
docker ps --filter "name=airflow" --format "table {{.Names}}\t{{.Status}}"

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° DAG'Ğ¾Ğ²
docker exec airflow-dag-processor airflow dags list

# 4. ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ DAG
docker exec airflow-dag-processor airflow dags show import_olap_data_monthly
```

### Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ

```bash
$ docker exec airflow-dag-processor airflow dags list

dag_id                   | fileloc                               | owners  | is_paused
=========================+=======================================+=========+===========
import_olap_data_monthly | /opt/airflow/dags/import_olap_data.py | airflow | True

âœ… DAG ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½!
```

### Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº UI

- **Airflow UI**: http://localhost:8082
- **Frontend**: http://localhost:3000

---

## ğŸ”§ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Airflow 3.x

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Apache Airflow 3.1.3                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   airflow-   â”‚       â”‚   airflow-dag-       â”‚       â”‚
â”‚  â”‚  api-server  â”‚       â”‚    processor         â”‚       â”‚
â”‚  â”‚              â”‚       â”‚                      â”‚       â”‚
â”‚  â”‚ UI + REST APIâ”‚       â”‚ ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ DAG'Ğ¾Ğ²       â”‚       â”‚
â”‚  â”‚ (Ğ¿Ğ¾Ñ€Ñ‚ 8082)  â”‚       â”‚ /opt/airflow/dags    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                  â”‚                       â”‚
â”‚                                  â–¼                       â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                         â”‚   airflow-   â”‚                â”‚
â”‚                         â”‚  scheduler   â”‚                â”‚
â”‚                         â”‚              â”‚                â”‚
â”‚                         â”‚ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ   â”‚                â”‚
â”‚                         â”‚ Ğ·Ğ°Ğ´Ğ°Ñ‡        â”‚                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             airflow-db (PostgreSQL 17)                  â”‚
â”‚                ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Airflow                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾Ñ‚ Airflow 2.x:**
- Ğ’ Airflow 3.x Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ DAG'Ğ¾Ğ² Ğ²Ñ‹Ğ½ĞµÑĞµĞ½ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ `dag-processor`
- `webserver` Ğ·Ğ°Ğ¼ĞµĞ½Ñ‘Ğ½ Ğ½Ğ° `api-server`
- REST API Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ (v1 â†’ v2), Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ CLI

---

## ğŸ“Š Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CRM DB    â”‚â”€â”€â”€â”€â–¶â”‚ import_olap_ â”‚
â”‚ (PostgreSQL)â”‚     â”‚ data_monthly â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    (DAG)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ Telemetry DBâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ (PostgreSQL)â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ClickHouse  â”‚
                    â”‚   default.*  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Reports API  â”‚â—€â”€â”€â”€ Frontend
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    MinIO     â”‚ (ĞºÑÑˆ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²)
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ CDC:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CRM DB    â”‚â”€â”€â”€â”€â–¶â”‚ Kafkaâ”‚â”€â”€â”€â”€â–¶â”‚  ClickHouse  â”‚
â”‚ Telemetry DBâ”‚     â”‚      â”‚     â”‚  debezium.*  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     (CDC)        (Debezium)      (Real-time)
```

---

## ğŸ“ ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

### Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ DAG'Ğ°Ğ¼Ğ¸

```bash
# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… DAG'Ğ¾Ğ²
docker exec airflow-dag-processor airflow dags list

# ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ DAG
docker exec airflow-dag-processor airflow dags unpause import_olap_data_monthly

# Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ DAG
docker exec airflow-scheduler airflow dags trigger import_olap_data_monthly

# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ²
docker exec airflow-scheduler airflow dags list-runs -d import_olap_data_monthly

# Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° DAG
docker exec airflow-dag-processor airflow dags show import_olap_data_monthly
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```bash
# ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ² ClickHouse
docker exec olap-db clickhouse-client --password clickhouse_password \
  --query "SELECT count() FROM default.users"

# Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ² ClickHouse
docker exec olap-db clickhouse-client --password clickhouse_password \
  --query "SELECT count() FROM default.telemetry_events"

# ĞŸĞ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¸
docker exec olap-db clickhouse-client --password clickhouse_password \
  --query "SELECT partition, count() FROM default.telemetry_events GROUP BY partition ORDER BY partition"
```

### Ğ›Ğ¾Ğ³Ğ¸

```bash
# Ğ›Ğ¾Ğ³Ğ¸ dag-processor
docker logs airflow-dag-processor -f

# Ğ›Ğ¾Ğ³Ğ¸ scheduler
docker logs airflow-scheduler -f

# Ğ›Ğ¾Ğ³Ğ¸ API server
docker logs airflow-webserver -f
```

---

## ğŸ“ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

1. **Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚:**
   ```bash
   .venv/bin/python tests/test_airflow_integration.py
   ```

2. **Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Playwright-Ñ‚ĞµÑÑ‚:**
   ```bash
   .venv/bin/python -m pytest tests/test_frontend_etl.py -v -s
   ```

3. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ UI:**
   - ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ http://localhost:3000
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ±Ğ»Ğ¾Ğº ETL-Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
   - Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
   - Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ ETL-Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ

4. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³:**
   - ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ http://localhost:8082
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ DAG
   - ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡

---

## âœ¨ Ğ˜Ñ‚Ğ¾Ğ³

**Ğ’ÑĞµ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹:**
- âœ… Apache Airflow 3.1.3 Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- âœ… DAG `import_olap_data_monthly` ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ
- âœ… Ğ¡Ñ…ĞµĞ¼Ñ‹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ñ‹ Ñ debezium
- âœ… start_date ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ½Ğ° 1 ÑĞ½Ğ²Ğ°Ñ€Ñ 2025
- âœ… Ğ¤Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½ Ñ ETL-ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ¸ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ ĞºÑÑˆĞ°
- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¸ UI-Ñ‚ĞµÑÑ‚Ñ‹
- âœ… Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ¸ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ

**Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ!** ğŸ‰
